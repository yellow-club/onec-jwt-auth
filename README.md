# onec-jwt-auth üöÄ
**JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è HTTP API –Ω–∞ 1–° (—Å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ Clean Architecture).**

> 1) –ü—É–±–ª–∏–∫—É–µ—Ç–µ **–¥–≤–∞** HTTP-—ç–Ω–¥–ø–æ–π–Ω—Ç–∞ –Ω–∞–±–æ—Ä–∞ (–¥–≤–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ `default.vrd`).
> 2) –ù–∞ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ **PAT** (fallback ‚Äî **Basic**) –ø–æ–ª—É—á–∞–µ—Ç **JWT**.
> 3) –ù–∞ –≤—Ç–æ—Ä–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤—Å–µ ‚Äú–±–æ–µ–≤—ã–µ‚Äù HTTP-—Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ç–æ–ª—å–∫–æ **Bearer JWT** (–ø–æ–¥–ø–∏—Å—å/iss/aud/exp –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ), –∞ –≤–Ω—É—Ç—Ä–∏ 1–° –¥–µ–ª–∞–µ—Ç—Å—è **–¥–≤–æ–π–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å** —á–µ—Ä–µ–∑ allowlist-—Ä–µ–≥–∏—Å—Ç—Ä `JWT–°–µ—Å—Å–∏–∏`.

---

## –ó–∞—á–µ–º —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî ‚Äú–≥–æ—Ç–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å‚Äù –¥–ª—è HTTP API –≤ 1–°, –≥–¥–µ:
- **JWT** (RS256) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞;
- **–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ claims –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ** –¥–µ–ª–∞–µ—Ç—Å—è —à—Ç–∞—Ç–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ `default.vrd`);
- –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è: **allowlist –ø–æ `jti` + —Ö—ç—à —Ç–æ–∫–µ–Ω–∞ + —Å—Ä–æ–∫ + –æ—Ç–∑—ã–≤**;
- –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ **–æ–±–ª–∞—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ (scopes)** –ø–æ–≤–µ—Ä—Ö —Ç–∏–ø–∏—á–Ω—ã—Ö 1–°-–ø—Ä–∞–≤;
- –∞ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –≤—Å—ë —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ **–ø–æ Clean Architecture**, –∞ –Ω–µ ‚Äú–∫–∞–∫ –æ–±—ã—á–Ω–æ –≤ 1–°‚Äù.

---

## üßº Clean Architecture ‚Äî –ø—Ä–∞–≤–∏–ª–æ ‚Ññ1

**–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∂–∏–≤—ë—Ç –ø–æ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.**
PR, –∫–æ—Ç–æ—Ä—ã–µ –≤–Ω–æ—Å—è—Ç ‚Äú–±—ã—Å—Ç—Ä—ã–µ‚Äù —Ä–µ—à–µ–Ω–∏—è –≤ –æ–±—Ö–æ–¥ —Å–ª–æ—ë–≤ (—Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ö–æ–¥—è—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é, HTTP-—Å–µ—Ä–≤–∏—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ —Ç.–ø.) ‚Äî –±—É–¥—É—Ç –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è/–ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è.

**–î–∞, —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã 1–° –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è.**
–ù–æ –µ—Å–ª–∏ –≤—ã–±–æ—Ä —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É ‚Äú–∫–∞–∫ –ø—Ä–∏–Ω—è—Ç–æ –≤ 1–°‚Äù –∏ ‚Äú–∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ Clean Architecture‚Äù ‚Äî –ø–æ–±–µ–∂–¥–∞–µ—Ç **Clean Architecture**.

–ü–æ–¥—Ä–æ–±–Ω–æ: —Å–º. `docs/ARCHITECTURE.md`.

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ 1: –ø–æ–ª—É—á–∏—Ç—å JWT (–ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Ññ1)
1. –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç `POST /hs/auth/token`
2. –ü–µ—Ä–µ–¥–∞—ë—Ç `Authorization: PAT pat.<uuid>.<secretHex>`
   (–∏–ª–∏ `Authorization: Basic <base64(login:password)>` –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤)
3. –°–µ—Ä–≤–∏—Å –≤—ã–¥–∞—ë—Ç JSON —Å `access_token` (JWT) –∏ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏.

### –ü–æ—Ç–æ–∫ 2: –≤—ã–∑–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-—ç–Ω–¥–ø–æ–π–Ω—Ç—ã (–ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Ññ2)
1. –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π —ç–Ω–¥–ø–æ–π–Ω—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä `GET /hs/chats/contacts`
2. –ü–µ—Ä–µ–¥–∞—ë—Ç `Authorization: Bearer <jwt>`
3. **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞/–ø—É–±–ª–∏–∫–∞—Ü–∏—è** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JWT (–ø–æ–¥–ø–∏—Å—å RS256, iss/aud/exp –∏ —Ç.–¥.) –ø–æ `default.vrd`
4. –í–Ω—É—Ç—Ä–∏ 1–° –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äú–¥–≤–æ–π–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å‚Äù –ø–æ `JWT–°–µ—Å—Å–∏–∏`:
   - –∑–∞–ø–∏—Å—å –ø–æ `jti` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - `–û—Ç–æ–∑–≤–∞–Ω = –õ–æ–∂—å`
   - `–î–µ–π—Å—Ç–≤—É–µ—Ç–î–æ` –Ω–µ –∏—Å—Ç—ë–∫
   - `–•—ç—à–¢–æ–∫–µ–Ω–∞` —Å–æ–≤–ø–∞–¥–∞–µ—Ç (SHA-256 hex –æ—Ç compact JWT)

---

## ‚ö†Ô∏è –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –¥–≤–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–¥–≤–∞ `default.vrd`)

–ü–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å **–¥–≤–µ —Ä–∞–∑–Ω—ã–µ –∑–æ–Ω—ã**:

1) **–ü—É–±–ª–∏–∫–∞—Ü–∏—è ‚Äú–≤—ã–¥–∞—Ç—å —Ç–æ–∫–µ–Ω‚Äù**
   - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Ö–æ–¥ –ø–æ **PAT/Basic**
   - **–ù–ï —Ç—Ä–µ–±—É–µ—Ç** JWT –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ

2) **–ü—É–±–ª–∏–∫–∞—Ü–∏—è ‚Äú–±–æ–µ–≤–æ–π API‚Äù**
   - **—Ç—Ä–µ–±—É–µ—Ç** `Authorization: Bearer ...`
   - JWT –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ —á–µ—Ä–µ–∑ `<accessTokenAuthentication>` –≤ `default.vrd`

–ü–æ–¥—Ä–æ–±–Ω–æ –∏ —Å –ø—Ä–∏–º–µ—Ä–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `default.vrd`: —Å–º. `docs/DEPLOYMENT.md`.

---

## –≠–Ω–¥–ø–æ–π–Ω—Ç—ã (–≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ)

> –ü—É—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –í –ø—Ä–∏–º–µ—Ä–∞—Ö –Ω–∏–∂–µ –±–∞–∑–æ–≤—ã–π URL –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
> `https://host/<publication>/hs/...`

### 1) –í—ã–¥–∞—Ç—å JWT
- **POST** `/hs/auth/token`
- Auth: `PAT` (primary) / `Basic` (fallback)
- Response: `{ "access_token": "<jwt>", "token_type": "Bearer", "expires_in": <sec> }`

### 2) –ü—Ä–∏–º–µ—Ä ‚Äú–±–æ–µ–≤–æ–≥–æ‚Äù API
- **GET** `/hs/chats/contacts`
- Auth: `Bearer JWT`
- Response: —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ)

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤: `docs/API.md`.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ **–Ω–µ –Ω–∏–∂–µ 8.3.27.1936**
- 1C:EDT (–ø—Ä–æ–µ–∫—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ EDT)

> **–í–∞–∂–Ω–æ:** –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –≤–µ–±‚Äë—Å–µ—Ä–≤–µ—Ä–µ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è ‚Äú–±–æ–µ–≤–æ–≥–æ‚Äù —Ä–µ–∂–∏–º–∞, —á—Ç–æ–±—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–∞ JWT –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ —á–µ—Ä–µ–∑ `default.vrd`.
> –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–≥–æ–Ω–æ–≤ –ª–æ–≥–∏–∫–∏ **–ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** ‚Äî –≤—Å—ë –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫—É **`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ`**.

### 1) –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç
1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `jwt_auth` –≤ EDT –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç

### 2) –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ`
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ò–ë (–≤ –æ—Ç–ª–∞–¥–∫–µ –∏–ª–∏ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ) –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ:

**–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∏ ‚Üí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

–≠—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–Ω—è–µ—Ç —Ç–æ—Ç –∂–µ –ø–∞–π–ø–ª–∞–π–Ω (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –±–∏–∑–Ω–µ—Å‚Äë–æ–ø–µ—Ä–∞—Ü–∏—è), —á—Ç–æ –∏ HTTP‚Äë–ø—É–±–ª–∏–∫–∞—Ü–∏—è, —Ç–æ–ª—å–∫–æ **–±–µ–∑ –≤–µ–±‚Äë—Å–µ—Ä–≤–µ—Ä–∞**.

### 3) –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å RSA‚Äë–∫–ª—é—á–∏ –¥–ª—è RS256
–ù—É–∂–Ω–∞ –ø–∞—Ä–∞ –∫–ª—é—á–µ–π:
- **private key** ‚Äî –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT –≤–Ω—É—Ç—Ä–∏ 1–°
- **public key** ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ (–≤ `default.vrd` –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ API)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî —á–µ—Ä–µ–∑ OpenSSL:

```bash
# private key (RSA 2048)
openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:2048 -out jwt_private.pem

# public key –∏–∑ private
openssl pkey -in jwt_private.pem -pubout -out jwt_public.pem
```

> –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. Private key —Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç.

### 4) –î–æ–±–∞–≤–∏—Ç—å **–∑–∞–∫—Ä—ã—Ç—ã–π** –∫–ª—é—á –≤ –ò–ë (—á–µ—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫—É)
–í –æ–±—Ä–∞–±–æ—Ç–∫–µ **`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ`** –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **¬´–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á¬ª** –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `jwt_private.pem`.

–ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ò–ë (—Ä—É—á–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç/—Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ).

### 5) –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PAT (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞)
–í —Ç–æ–π –∂–µ –æ–±—Ä–∞–±–æ—Ç–∫–µ:
1. –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞—Ç–∞–ª–æ–≥ `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏`)
2. –£–∫–∞–∂–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
3. –ù–∞–∂–º–∏—Ç–µ **¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PAT¬ª**

–ù–∞ –≤—ã—Ö–æ–¥–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Ñ–æ—Ä–º–∞—Ç–∞:

`PAT pat.<uuid>.<secretHex>`

PAT —Ç–æ–∫–µ–Ω –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ `PAT–¢–æ–∫–µ–Ω`.

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PAT —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –∑–∞–ø–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (—Ä–µ–≥–∏—Å—Ç—Ä `–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ–¢–æ–∫–µ–Ω—ã–î–æ—Å—Ç—É–ø–∞`). **–ù–∏—á–µ–≥–æ –≤—Ä—É—á–Ω—É—é ‚Äú–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å‚Äù –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.**

> –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–¥–∞—á—É JWT –ø–æ **Basic**, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **¬´–°–≤—è–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ò–ë¬ª** (–ø—Ä–∏–≤—è–∑–∫–∞ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±–∞–∑—ã).

### 6) –ü–æ–ª—É—á–∏—Ç—å JWT
- –ù–∞–∂–º–∏—Ç–µ **¬´–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è¬ª** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç PAT)
- –∏–ª–∏ **¬´BasicAuth¬ª** (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø—É—Ç—å)

JWT –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–æ–ª–µ `JWT–¢–æ–∫–µ–Ω`.

–ü—Ä–∏ –≤—ã–¥–∞—á–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ allowlist‚Äë—Ä–µ–≥–∏—Å—Ç—Ä–µ `JWT–°–µ—Å—Å–∏–∏` (jti, hash, exp, revoke). **–†—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `JWT–°–µ—Å—Å–∏–∏` –Ω–µ—Ç –∏ –Ω–µ –Ω—É–∂–Ω–æ.**

### 7) –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äú–±–æ–µ–≤–æ–π‚Äù —ç–Ω–¥–ø–æ–π–Ω—Ç –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
–ù–∞–∂–º–∏—Ç–µ **¬´–ö–æ–Ω—Ç–∞–∫—Ç—ã¬ª** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é `GET /hs/chats/contacts`, —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ `–ü–∞–π–ø–ª–∞–π–ΩAPI`.

–≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å **–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã/–≤–∞–ª–∏–¥–∞—Ü–∏–∏/–¥–æ—Å—Ç—É–ø/–±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫—É** –±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è –≤–µ–±‚Äë–ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

> –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT –∏–∑ `default.vrd` (iss/aud/–ø–æ–¥–ø–∏—Å—å/exp –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ) –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** ‚Äî –æ–Ω–∞ –≤–∫–ª—é—á–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π –ò–ë.

### 8) –ë–æ–µ–≤–æ–π —Ä–µ–∂–∏–º: –¥–≤–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (2√ó VRD)
–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–Ω—ã **–¥–≤–µ** –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ `default.vrd`:

1) **AUTH‚Äë–ø—É–±–ª–∏–∫–∞—Ü–∏—è** ‚Äî –≤—ã–¥–∞—á–∞ JWT –ø–æ PAT/Basic (JWT –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ –Ω–µ –≤–∫–ª—é—á–∞–µ–º)  
2) **API‚Äë–ø—É–±–ª–∏–∫–∞—Ü–∏—è** ‚Äî –±–∏–∑–Ω–µ—Å–æ–≤—ã–µ HTTP‚Äë—Å–µ—Ä–≤–∏—Å—ã, –∑–∞–∫—Ä—ã—Ç—ã–µ JWT –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ (RS256, aud/iss, public key)

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ —à–∞–±–ª–æ–Ω—ã VRD:
- `docs/DEPLOYMENT.md`
- `deploy/vrd/*.example`
## –õ–æ–≥–∏, –æ—à–∏–±–∫–∏ –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è

- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π ‚Äî `–ü–∞–π–ø–ª–∞–π–ΩAPI`
- –û—à–∏–±–∫–∏ –º–∞–ø–ø—è—Ç—Å—è –≤ **400 / 401 / 403 / 500**
- –¢–µ–ª–æ –æ—à–∏–±–∫–∏ (JSON):
```json
{
  "–æ—à–∏–±–∫–∞": {
    "–∫–æ–¥": "API.–î–æ—Å—Ç—É–ø.AUTHN.NO_AUTH",
    "—Å–æ–æ–±—â–µ–Ω–∏–µ": "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.",
    "–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è": "..."
  }
}
```
- –í –ª–æ–≥–∞—Ö/–æ—Ç–≤–µ—Ç–∞—Ö —Å–µ–∫—Ä–µ—Ç—ã –∏ —Ç–æ–∫–µ–Ω—ã **—Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è** (REDACTED)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è `X-Correlation-Id` (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/ARCHITECTURE.md` ‚Äî —Å–ª–æ–∏, –ø—Ä–∞–≤–∏–ª–∞, –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–π–Ω—Ç—ã
- `docs/DEPLOYMENT.md` ‚Äî –¥–≤–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, `default.vrd`, JWT –Ω–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ
- `docs/API.md` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã API –∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- `docs/SECURITY.md` ‚Äî –ø—Ä–æ –∫–ª—é—á–∏, –ª–æ–≥–∏, —É–≥—Ä–æ–∑—ã

---

## –ö–∞–∫ –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏—Ç—å

1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `docs/ARCHITECTURE.md` (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∞–≤–∏–ª–∞ —Å–ª–æ—ë–≤)
2. –°–æ–∑–¥–∞—Ç—å issue / –æ–±—Å—É–¥–∏—Ç—å –¥–∏–∑–∞–π–Ω
3. –°–¥–µ–ª–∞—Ç—å PR –ø–æ `CONTRIBUTING.md`

---

## –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è: MIT (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –ø–æ–¥ –≤–∞—à–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è). –°–º. `LICENSE`.
