# Архитектура (Clean Architecture)

Этот проект специально устроен так, чтобы **HTTP API в 1С выглядел как обычное приложение с Clean Architecture**: порты/адаптеры, сценарии, контроллеры, презентеры и единая точка входа.

## Слои и ответственность

### 1) Delivery / Interface (граница)
Где живёт всё, что связано с HTTP и контрактами:
- `HTTPServices/*` — тонкие обработчики HTTP-сервисов (не содержат бизнес-логики)
- `ПайплайнAPI` — единый вход, корреляция, try/catch, логирование
- `Контракт_*` — разбор входа (заголовки/параметры) + базовые валидации
- `HTTPОтветчикAPI`, `HTTPМапперОшибокAPI`, `HTTPПротоколAPI` — ответ/ошибки/заголовки

**Правило:** HTTP-слой только “переводит” запрос в входную структуру и передаёт дальше.

### 2) Application (use-cases)
- `Сценарий*` — сценарии (use-cases): аутентификация, выдача JWT, построение контекста доступа
- `Контроллер*` — вызывает сценарии и возвращает представление через презентер
- `Политика*` — политики (конфиг/правила), которые удобно тестировать и менять

**Правило:** сценарии не знают про HTTP и не зависят от конкретных регистров/справочников.

### 3) Infrastructure (адаптеры)
- `Адаптер*` — реализация портов: чтение регистров/справочников, криптография платформы, и т.д.

**Правило:** если нужно ходить в регистр/справочник — делаем адаптер и вызываем его через порт.

## “Точка сборки” (composition root)

Сборка зависимостей вынесена из HTTP-сервисов в отдельные модули:
- `КомпозицияАвторизацияAPI`
- `КомпозицияЧатыAPI`
- `КомпозицияДоступа`

HTTP-сервис берёт “контроллер” из композиции и не знает, из чего он собран.

## Как добавить новый бизнес-эндпойнт

Чек‑лист (рекомендуемый путь):
1. Добавить HTTP-service + метод (тонкий): `HTTPServices/<...>`
2. Сделать контракт `Контракт_<METHOD>_<...>` (парсинг входа)
3. Добавить контроллер `Контроллер<...>API`
4. Добавить сценарий `Сценарий<...>`
5. Добавить презентер `Презентер<...>`
6. Прописать сборку в `Композиция...`
7. Зарегистрировать операцию в `ОперацииAPI` и настроить политику доступа в `ПолитикиДоступаОпераций`

## Архитектурные запреты (важно)

- ❌ Сценарии НЕ обращаются к регистрам/справочникам напрямую
- ❌ HTTPServices НЕ содержат бизнес-логики
- ❌ Нельзя логировать токены/секреты без санитизации
- ✅ Можно добавлять 1С‑стандарты, если они не ломают архитектурные границы

Если сомневаетесь — открывайте issue и обсуждайте дизайн.
